# 1
# Домашнее задание №3.
# В этой части нашего домашнего задания мы ознакомимся с
# математическим моделированием. Вам необходимо усвоить основные навыки
# программирования математических функций.
# Задание 1
# Смоделируете три закона распределения биномиальное, хи-квадрат,
# нормальное. Можно именно смоделировать, создать с помощью программного
# кода, или найти в интернете нужный вам датасет. Кому не хочется заниматься
# поиском, то делаем следующим образом:
# k – ваш порядковый номер по алфавиту в группе, n – общее количество
# студентов в группе.
# 1. Для биномиального: p = k/n, n (объем выборки) = n
# 2. Для хи-квадрат: df = (n-1) + k
# 3. Для нормалного закона: m = k*100, sigma = корень из (n + k)
# Для полученных распределений посчитать математическое ожидание,
# дисперсию, стандартное отклонение, моду, медиану. Нарисовать графики
# функций плотности распределения и функции распределения.
# Задание 2
# Решить следующие задачи программным кодом:
# 1). Компания, сдающая машины в прокат, владеет 60 автомобилями, 35 из
# них фирменной расцветки. Известно, что 5 автомобилей в данный момент
# находятся в ремонте. Найти вероятность того, что
# а) ровно два автомобиля из ремонтирующихся – фирменной расцветки.
# б) сейчас ремонтируется хотя бы один из автомобилей фирменной
# расцветки.
# 2). Вы решили узнать, есть ли среди ваших однокурсников кто-нибудь, у
# кого день рождения (без учета года) совпадает с вашим.
# Понятно, что если вы узнаете дату др только одного однокурсника, то
# вероятность того, что вы сразу нашли нужного, довольно мала.
# Если вы узнаете дату др двоих однокурсников, то вероятность того, что
# среди них есть нужный, чуть выше. Если бы на курсе училось 100-200-300
# 2
# человек, то вероятность того, что среди них есть хотя бы один с нужной датой
# ДР, должна быть довольно большой.
# а) На первом курсе вместе с вами учится 390 человек. Найти вероятность
# того, что среди них есть хотя бы один с нужной датой ДР.
# б) Сколько человек должно учиться вместе с вами на курсе, чтобы
# вероятность того, что среди них есть хотя бы один нужный вам, была больше
# 0.5?
# (для простоты не будем учитывать високосные годы)
# 3). В покер все играли?
# Правила игры в покер.
# В карточной игре покер игрок получает 5 карт из колоды в 52 карты.
# Задача игрока собрать наиболее сильную комбинацию карт. Комбинации
# бывают следующие:
# а) пара - две карты одного номинала;
# б) две пары - две карты одного номинала, две карты другого;
# в) тройка - три карты одного номинала;
# г) стрит - пять последовательных по номиналу карт (предполагается, что
# за тузом по номиналу следует двойка);
# д) флэш - все карты одной масти;
# е) три+два - три карты одного номинала, две карты другого;
# ж) каре - четыре карты одного номинала;
# з) стрит-флэш - пять последовательных по номиналу карт одной масти;
# b) ройал-флэш - туз, король, дама, валет и десятка одной и той же масти.
# Найдите вероятность получения каждой из перечисленных комбинаций
# при случайной сдаче карт. Вычислите вероятность того, что не выпадет ни
# одна из вышеперечисленных комбинаций.

# Задание 1: Моделирование распределений
# Предположим k = 10, n = 30 для примера

# Биномиальное распределение
k <- 10
n <- 30
p <- k/n
size <- 1000  # размер выборки

# Генерируем выборку
binom_sample <- rbinom(size, n, p)

# Вычисляем статистики
binom_mean <- mean(binom_sample)
binom_var <- var(binom_sample)
binom_sd <- sd(binom_sample)
binom_median <- median(binom_sample)
binom_mode <- as.numeric(names(sort(table(binom_sample), decreasing = TRUE)[1]))

# Графики для биномиального распределения
par(mfrow=c(1,2))
hist(binom_sample, probability = TRUE, main = "Плотность биномиального распределения")
lines(density(binom_sample), col = "red")
plot(ecdf(binom_sample), main = "Функция распределения")

# Хи-квадрат распределение
df <- (n-1) + k
chi_sample <- rchisq(size, df)

# Аналогичные вычисления для хи-квадрат
chi_mean <- mean(chi_sample)
chi_var <- var(chi_sample)
chi_sd <- sd(chi_sample)
chi_median <- median(chi_sample)
chi_mode <- as.numeric(names(sort(table(round(chi_sample, 1)), decreasing = TRUE)[1]))

# Графики для хи-квадрат
par(mfrow=c(1,2))
hist(chi_sample, probability = TRUE, main = "Плотность хи-квадрат")
lines(density(chi_sample), col = "red")
plot(ecdf(chi_sample), main = "Функция распределения")

# Нормальное распределение
m <- k * 100
sigma <- sqrt(n + k)
norm_sample <- rnorm(size, m, sigma)

# Вычисления для нормального
norm_mean <- mean(norm_sample)
norm_var <- var(norm_sample)
norm_sd <- sd(norm_sample)
norm_median <- median(norm_sample)
norm_mode <- as.numeric(names(sort(table(round(norm_sample, 1)), decreasing = TRUE)[1]))

# Графики для нормального
par(mfrow=c(1,2))
hist(norm_sample, probability = TRUE, main = "Плотность нормального")
lines(density(norm_sample), col = "red")
plot(ecdf(norm_sample), main = "Функция распределения")

# Задание 2.1 - Задача про автомобили
# Используем гипергеометрическое распределение

# а) Вероятность ровно двух фирменных из ремонтируемых
prob_2_brand <- dhyper(2, 35, 25, 5)

# б) Вероятность хотя бы одного фирменного
prob_at_least_1 <- 1 - dhyper(0, 35, 25, 5)

# Задание 2.2 - Задача про дни рождения
# а) Вероятность совпадения среди 390 человек
prob_birthday <- 1 - prod(1 - 1:389/365)

# б) Поиск количества людей для вероятности > 0.5
n <- 1
while((1 - prod(1 - 1:(n-1)/365)) <= 0.5) {
  n <- n + 1
}

# Задание 2.3 - Покер
# Функция для вычисления количества комбинаций
combinations <- function(n, r) {
  factorial(n) / (factorial(r) * factorial(n - r))
}

# Общее количество возможных рук
total_hands <- combinations(52, 5)

# 1. Пара (две карты одного номинала)
pair_prob <- (13 * combinations(4, 2) * combinations(12, 3) * 4^3) / total_hands

# 2. Две пары
two_pairs_prob <- (combinations(13, 2) * combinations(4, 2) * combinations(4, 2) * combinations(11, 1) * 4) / total_hands

# 3. Тройка (три карты одного номинала)
three_kind_prob <- (13 * combinations(4, 3) * combinations(12, 2) * 4^2) / total_hands

# 4. Стрит (пять последовательных карт)
# Учитываем особый случай А-2-3-4-5 и обычные стриты
straight_prob <- (10 * 4^5) / total_hands

# 5. Флэш (все карты одной масти)
flush_prob <- (4 * combinations(13, 5) - 40) / total_hands  # вычитаем стрит-флэши

# 6. Фулл-хаус (три + два)
full_house_prob <- (13 * combinations(4, 3) * 12 * combinations(4, 2)) / total_hands

# 7. Каре (четыре карты одного номинала)
four_kind_prob <- (13 * combinations(4, 4) * 12 * 4) / total_hands

# 8. Стрит-флэш (включая роял-флэш)
straight_flush_prob <- 40 / total_hands

# 9. Роял-флэш (особый случай стрит-флэша)
royal_flush_prob <- 4 / total_hands

# Вероятность не получить ни одной комбинации (старшая карта)
high_card_prob <- 1 - (pair_prob + two_pairs_prob + three_kind_prob + straight_prob + 
                       flush_prob + full_house_prob + four_kind_prob + straight_flush_prob)

# Вывод результатов
cat("Вероятности покерных комбинаций:\n")
cat("Пара:", round(pair_prob, 4), "\n")
cat("Две пары:", round(two_pairs_prob, 4), "\n")
cat("Тройка:", round(three_kind_prob, 4), "\n")
cat("Стрит:", round(straight_prob, 4), "\n")
cat("Флэш:", round(flush_prob, 4), "\n")
cat("Фулл-хаус:", round(full_house_prob, 4), "\n")
cat("Каре:", round(four_kind_prob, 4), "\n")
cat("Стрит-флэш:", round(straight_flush_prob, 4), "\n")
cat("Роял-флэш:", round(royal_flush_prob, 4), "\n")
cat("Старшая карта:", round(high_card_prob, 4), "\n")